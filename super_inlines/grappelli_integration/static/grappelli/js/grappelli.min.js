var grp={jQuery:jQuery.noConflict(!0)},django={jQuery:grp.jQuery.noConflict(!0)},inputTypes=["[type='search']","[type='email']","[type='url']","[type='tel']","[type='number']","[type='range']","[type='date']","[type='month']","[type='week']","[type='time']","[type='datetime']","[type='datetime-local']","[type='color']"].join(",");!function(e){grappelli.getFormat=function(e){if("date"==e){var t=DATE_FORMAT.toLowerCase().replace(/%\w/g,function(e){return e=e.replace(/%/,""),e+e});return t}},grappelli.cleanInputTypes=function(){e("form").each(function(){e(this).find(":input").filter(inputTypes).each(function(){e(this).attr("type","text")})})},grappelli.initDateAndTimePicker=function(){e("p.datetime").each(function(){var t=e(this).html();t=t.replace(/^\w*: /,""),t=t.replace(/<br>[^<]*: /g,"<br>"),e(this).html(t)});var t={constrainInput:!1,showOn:"button",buttonImageOnly:!1,buttonText:"",dateFormat:grappelli.getFormat("date"),showButtonPanel:!0,showAnim:"",beforeShow:function(){grappelli.datepicker_instance=this}},r=e("input[class*='vDateField']:not([id*='__prefix__'])");r.datepicker(t),"undefined"!=typeof IS_POPUP&&IS_POPUP&&r.datepicker("disable"),e(document).on("click",".ui-datepicker-current",function(){e.datepicker._selectDate(grappelli.datepicker_instance),grappelli.datepicker_instance=null}),e("input[class*='vTimeField']:not([id*='__prefix__'])").grp_timepicker()},grappelli.initFilter=function(){e("a.grp-pulldown-handler").click(function(){var t=e(this).closest(".grp-pulldown-container");e(t).toggleClass("grp-pulldown-state-open").children(".grp-pulldown-content").toggle()}),e("a.grp-pulldown-handler").bind("mouseout",function(){e(this).blur()}),e(".grp-filter-choice").change(function(){location.href=e(this).val()})},grappelli.initSearchbar=function(){var t=e("input.grp-search-field");t.focus()},grappelli.updateSelectFilter=function(e){"undefined"!=typeof SelectFilter&&(e.find(".selectfilter").each(function(e,t){var r=t.name.split("-");SelectFilter.init(t.id,r[r.length-1],!1,"{% admin_media_prefix %}")}),e.find(".selectfilterstacked").each(function(e,t){var r=t.name.split("-");SelectFilter.init(t.id,r[r.length-1],!0,"{% admin_media_prefix %}")}))},grappelli.reinitDateTimeFields=function(e){e.find(".vDateField").datepicker({constrainInput:!1,showOn:"button",buttonImageOnly:!1,buttonText:"",dateFormat:grappelli.getFormat("date")}),e.find(".vTimeField").grp_timepicker()},grappelli.get_app_label=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("/");return r[r.length-3]}return!1},grappelli.get_model_name=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("/");return r[r.length-2]}return!1},grappelli.get_query_string=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("/");return pairs=r[r.length-1].replace("?","").split("&"),pairs.join(":")}return!1}}(grp.jQuery),function(e){e.fn.grp_collapsible=function(r){var i={toggle_handler_slctr:".grp-collapse-handler:first",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_toggle:function(){}},n=e.extend(i,r);return this.each(function(){t(e(this),n)})};var t=function(e,t){t.on_init(e,t),r(e,t)},r=function(e,t){i(e,t)},i=function(e,t){e.children(t.toggle_handler_slctr).click(function(){e.toggleClass(t.closed_css).toggleClass(t.open_css),t.on_toggle(e,t)})}}(grp.jQuery),function(e){e.fn.grp_collapsible_group=function(r){var i={open_handler_slctr:".grp-open-handler",close_handler_slctr:".grp-close-handler",collapsible_container_slctr:".grp-collapse",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_open:function(){},on_close:function(){}};return r=e.extend(i,r),this.each(function(){t(e(this),r)})};var t=function(e,t){t.on_init(e,t),r(e,t)},r=function(e,t){i(e,t),n(e,t)},i=function(t,r){t.find(r.open_handler_slctr).each(function(){e(this).click(function(){r.on_open(t,r),t.find(r.collapsible_container_slctr).removeClass(r.closed_css).addClass(r.open_css),t.removeClass(r.closed_css).addClass(r.open_css)})})},n=function(t,r){t.find(r.close_handler_slctr).each(function(){e(this).click(function(){r.on_close(t,r),t.find(r.collapsible_container_slctr).removeClass(r.open_css).addClass(r.closed_css)})})}}(grp.jQuery),function(e){e.widget("ui.grp_timepicker",{options:{template:'<div id="ui-timepicker" class="module" style="position: absolute; display: none;"></div>',timepicker_selector:"#ui-timepicker",offset:{top:0},default_time_list:["now","00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],time_list:[]},_create:function(){var t=this;e(document).mousedown(function(r){if(t.timepicker.is(":visible")){var i=e(r.target);i[0].id==t.timepicker[0].id||0!==i.parents(t.options.timepicker_selector).length||i.hasClass("hasTimepicker")||i.hasClass("ui-timepicker-trigger")||t.timepicker.hide()}}),e(document).keyup(function(e){27==e.keyCode&&t.timepicker.hide()}),0===e(this.options.timepicker_selector).size()&&e(this.options.template).appendTo("body"),this.timepicker=e(this.options.timepicker_selector),this.timepicker.hide(),this.element.addClass("hasTimepicker"),this.button=e('<button type="button" class="ui-timepicker-trigger"></button>'),this.element.after(this.button),this.element.prop("disabled")?this.button.prop("disabled",!0):this.button.click(function(){t._toggleTimepicker()})},_toggleTimepicker:function(){this.timepicker.is(":visible")?this.timepicker.hide():(this.element.focus(),this._generateTimepickerContents(),this._showTimepicker())},_generateTimepickerContents:function(){var t=this,r="<ul>";0===this.options.time_list.length&&(this.options.time_list=this.options.default_time_list);for(var i=0;i<this.options.time_list.length;i++)if("now"==this.options.time_list[i]){var n=new Date,a=n.getHours(),o=n.getMinutes();a=10>a?"0"+a:a,o=10>o?"0"+o:o,r+='<li class="ui-state-active row">'+a+":"+o+"</li>"}else r+='<li class="ui-state-default row">'+this.options.time_list[i]+"</li>";r+="</ul>",this.timepicker.html(r),this.timepicker.find("li").click(function(){e(this).parent().children("li").removeClass("ui-state-active"),e(this).addClass("ui-state-active"),t.element.val(e(this).html()),t.timepicker.hide()})},_showTimepicker:function(){var e=document.documentElement.clientHeight,t=document.documentElement.scrollTop||document.body.scrollTop,r=this.element.outerHeight(),i=this.timepicker.outerHeight()+r,n=this.element.offset().top,a=this.element.offset().left,o=n-t+i+60;if(e>o){var l=n+r;this.timepicker.css("left",a+"px").css("top",l+"px")}else{var p=n-i+r;this.timepicker.css("left",a+"px").css("top",p+"px")}this.timepicker.show()},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments)}})}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_fk.defaults,t),this.each(function(){var i=e(this),n=i.parent();n.find("a.related-lookup").next().is("strong")&&(n.find("a.related-lookup").get(0).nextSibling.nodeValue="",n.find("a.related-lookup").next("strong").remove()),n.find("a.related-lookup").after(t.placeholder),i.addClass("grp-has-related-lookup"),r(i,t),i.bind("change focus keyup",function(){r(i,t)})})}};e.fn.grp_related_fk=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_fk"),!1):t.init.apply(this,arguments)};var r=function(t,r){var i=t.parent().find(".grp-placeholder-related-fk");e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(e){""===e[0].label?i.hide():i.show(),i.html('<span class="grp-placeholder-label">'+e[0].label+"</span>")})};e.fn.grp_related_fk.defaults={placeholder:'<div class="grp-placeholder-related-fk"></div>',repr_max_length:30,lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_m2m.defaults,t),this.each(function(){var i=e(this);i.parent().find("a.related-lookup").after(t.placeholder),i.next().addClass("grp-m2m"),i.addClass("grp-has-related-lookup"),r(i,t),i.bind("change focus keyup",function(){r(i,t)})})}};e.fn.grp_related_m2m=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_m2m"),!1):t.init.apply(this,arguments)};var r=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(r){values=e.map(r,function(e){return'<span class="grp-placeholder-label">'+e.label+"</span>"}),""===values?t.parent().find(".grp-placeholder-related-m2m").hide():t.parent().find(".grp-placeholder-related-m2m").show(),t.parent().find(".grp-placeholder-related-m2m").html(values.join('<span class="grp-separator"></span>'))})};e.fn.grp_related_m2m.defaults={placeholder:'<div class="grp-placeholder-related-m2m"></div>',repr_max_length:30,lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_generic.defaults,t),this.each(function(){var a=e(this),o=e(t.content_type).val()||e(t.content_type).find(":checked").val();o&&a.after(t.placeholder).after(r(a.attr("id"),o)),a.addClass("grp-has-related-lookup"),o&&n(a,t),a.bind("change focus keyup",function(){n(a,t)}),e(t.content_type).bind("change",function(){i(e(this),t)})})}};e.fn.grp_related_generic=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_generic"),!1):t.init.apply(this,arguments)};var r=function(t,r){var i=e('<a class="related-lookup"></a>');return i.attr("id","lookup_"+t),i.attr("href","../../../"+MODEL_URL_ARRAY[r].app+"/"+MODEL_URL_ARRAY[r].model+"/?"),i.attr("onClick","return showRelatedObjectLookupPopup(this);"),i},i=function(t,i){var n=e(i.object_id);n.val(""),n.parent().find("a.related-lookup").remove(),n.parent().find(".grp-placeholder-related-generic").remove();var a=e(t).val()||e(t).find(":checked").val();a&&n.after(i.placeholder).after(r(n.attr("id"),a))},n=function(t,r){var i=t.next().next();e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(e){""===e[0].label?i.hide():i.show(),i.html('<span class="grp-placeholder-label">'+e[0].label+"</span>")})};e.fn.grp_related_generic.defaults={placeholder:'<div class="grp-placeholder-related-generic" style="display:none"></div>',repr_max_length:30,lookup_url:"",content_type:"",object_id:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_fk.defaults,t),this.each(function(){var o=e(this);o.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field"),o.next().next()&&"errorlist"!=o.next().next().attr("class")&&"grp-help"!=o.next().next().attr("class")&&o.next().next().remove(),o.next().after(r).after(i(o.attr("id"))),o.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>"),o.parent().prepend("<input id='"+o.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />"),t=e.extend({wrapper_autocomplete:o.parent(),input_field:o.prev(),remove_link:o.next().next().hide(),loader:o.next().next().next().hide()},e.fn.grp_autocomplete_fk.defaults,t),a(o,t),n(o,t),o.bind("change focus keyup",function(){a(o,t)}),e("label[for='"+o.attr("id")+"']").each(function(){e(this).attr("for",o.attr("id")+"-autocomplete")})})}};e.fn.grp_autocomplete_fk=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_fk"),!1):t.init.apply(this,arguments)};var r=function(){var t=e('<div class="grp-loader">loader</div>');return t},i=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},n=function(t,r){r.wrapper_autocomplete.find("input:first").bind("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,delay:1e3,source:function(i,n){e.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(i.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(){r.loader.show()},success:function(t){n(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(){r.loader.hide()}})},focus:function(){return!1},select:function(i,n){return r.input_field.val(n.item.label),t.val(n.item.value),t.trigger("change"),t.val()?e(r.remove_link).show():e(r.remove_link).hide(),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append("<a>"+r.label+"</a>").appendTo(t):e("<li></li>").data("item.autocomplete",r).append("<span class='error'>"+r.label+"</span>").appendTo(t)}},a=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(i){e.each(i,function(n){r.input_field.val(i[n].label),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})})};e.fn.grp_autocomplete_fk.defaults={autocomplete_lookup_url:"",lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_m2m.defaults,t),this.each(function(){var r=e(this);r.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field"),r.next().after(n).after(a(r.attr("id"))),r.parent().wrapInner("<div class='grp-autocomplete-wrapper-m2m'></div>"),r.parent().prepend("<ul class='grp-repr'><li class='grp-search'><input id='"+r.attr("id")+"-autocomplete' type='text' class='vTextField' value='' /></li></ul>"),t=e.extend({wrapper_autocomplete:r.parent(),wrapper_repr:r.parent().find("ul.grp-repr"),wrapper_search:r.parent().find("li.grp-search"),remove_link:r.next().next().hide(),loader:r.next().next().next().hide()},e.fn.grp_autocomplete_m2m.defaults,t),r.parent().find("ul.errorlist")&&r.parent().find("ul.errorlist").detach().appendTo(r.parent().parent()),p(r,t),l(r,t),r.bind("change focus keyup",function(){p(r,t)}),e("label[for='"+r.attr("id")+"']").each(function(){e(this).attr("for",r.attr("id")+"-autocomplete")}),t.wrapper_autocomplete.bind("click",function(r){e(r.target).hasClass("related-lookup")||e(r.target).hasClass("grp-related-remove")||t.wrapper_search.find("input:first").focus()})})}};e.fn.grp_autocomplete_m2m=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_m2m"),!1):t.init.apply(this,arguments)};var r=function(e,t){var r=[];return e.val()&&(r=e.val().split(",")),r.push(t),e.val(r.join(",")),e.trigger("change"),r.join(",")},i=function(e,t){var r=[];return e.val()&&(r=e.val().split(",")),r.splice(t,1),e.val(r.join(",")),e.trigger("change"),r.join(",")},n=function(){var t=e('<div class="grp-loader">loader</div>');return t},a=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},o=function(t,r,n){var a=e('<li class="grp-repr"></li>'),o=e('<a class="grp-m2m-remove" href="javascript://">'+r+"</a>");a.append(o),a.insertBefore(n.wrapper_search),o.bind("click",function(r){var a=e(this).parent().parent().children("li").index(e(this).parent());i(t,a,n),e(this).parent().remove(),t.val()?e(n.remove_link).show():e(n.remove_link).hide(),r.stopPropagation()}),o.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")})},l=function(t,i){i.wrapper_search.find("input:first").bind("keydown",function(t){t.keyCode===e.ui.keyCode.TAB&&e(this).data("uiAutocomplete").menu.active&&t.preventDefault()}).bind("focus",function(){i.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){i.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,delay:1e3,position:{my:"left top",at:"left bottom",of:i.wrapper_autocomplete},open:function(){e(".ui-menu").width(i.wrapper_autocomplete.outerWidth()-6)},source:function(r,n){e.ajax({url:i.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(r.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(){i.loader.show()},success:function(t){n(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(){i.loader.hide()}})},focus:function(){return!1},select:function(n,a){return o(t,a.item.label,i),r(t,a.item.value,i),t.val()?e(i.remove_link).show():e(i.remove_link).hide(),e(this).val("").focus(),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append("<a>"+r.label+"</a>").appendTo(t):e("<li></li>").data("item.autocomplete",r).append("<span class='error'>"+r.label+"</span>").appendTo(t)}},p=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(i){r.wrapper_repr.find("li.grp-repr").remove(),r.wrapper_search.find("input").val(""),e.each(i,function(e){i[e].value&&o(t,i[e].label,r)}),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_generic.defaults,t),this.each(function(){var p=e(this);p.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field");var s=e(t.content_type).val()||e(t.content_type).find(":checked").val();s&&p.after(r).after(i(p.attr("id"))).after(n(p.attr("id"),s)),p.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>"),p.parent().prepend("<input id='"+p.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />"),t=e.extend({wrapper_autocomplete:e(this).parent(),input_field:e(this).prev(),remove_link:p.nextAll("a.grp-related-remove").hide(),loader:p.nextAll("div.grp-loader").hide()},e.fn.grp_autocomplete_generic.defaults,t),s&&l(p,t),o(p,t),p.bind("change focus keyup",function(){l(p,t)}),e(t.content_type).bind("change",function(){a(e(this),t)}),e("label[for='"+p.attr("id")+"']").each(function(){e(this).attr("for",p.attr("id")+"-autocomplete")})})}};e.fn.grp_autocomplete_generic=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_generic"),!1):t.init.apply(this,arguments)};var r=function(){var t=e('<div class="grp-loader">loader</div>');return t},i=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},n=function(t,r){var i=e('<a class="related-lookup"></a>');return i.attr("id","lookup_"+t),i.attr("href","../../../"+MODEL_URL_ARRAY[r].app+"/"+MODEL_URL_ARRAY[r].model+"/?"),i.attr("onClick","return showRelatedObjectLookupPopup(this);"),i},a=function(t,a){var o=e(a.object_id);o.val(""),o.prev().val(""),o.nextAll("a.related-lookup").remove(),o.nextAll("a.grp-related-remove").remove(),o.nextAll("div.grp-loader").remove();var l=e(t).val()||e(t).find(":checked").val();l&&(o.after(r).after(i(o.attr("id"))).after(n(o.attr("id"),l)),a.remove_link=o.nextAll("a.grp-related-remove").hide(),a.loader=o.nextAll("div.grp-loader").hide())},o=function(t,r){r.wrapper_autocomplete.find("input:first").bind("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,delay:1e3,source:function(i,n){e.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(i.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(){var t=e(r.content_type).val()||e(r.content_type).find(":checked").val();return t?void r.loader.show():!1},success:function(t){n(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(){r.loader.hide()}})},focus:function(){return!1},select:function(i,n){return r.input_field.val(n.item.label),t.val(n.item.value),t.trigger("change"),t.val()?e(r.remove_link).show():e(r.remove_link).hide(),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append("<a>"+r.label+"</a>").appendTo(t):e("<li></li>").data("item.autocomplete",r).append("<span class='error'>"+r.label+"</span>").appendTo(t)}},l=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(i){e.each(i,function(n){r.input_field.val(i[n].label),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})})};e.fn.grp_autocomplete_generic.defaults={autocomplete_lookup_url:"",lookup_url:"",content_type:"",object_id:""}}(grp.jQuery),function(e){function t(t,r){if(this.formset=t,this.updateIndex(this.formset.forms.length),this.formset.forms.push(this),this.isInitial="undefined"!=typeof r,this.isInitial){this.$row=r;var i=this.$row.find('[name="'+this.prefix+'-id"]');this.hasOriginal=""!==i.val()}else this.$row=this.formset.$templateForm.clone(!0).removeClass(this.formset.emptyCssClass).addClass(this.formset.formCssClass),this.hasOriginal=!1;this.$tools=this.$row.find("tabular"==this.formset.inlineType?"> .grp-tr > .grp-tools-container > .grp-tools":"> .grp-tools"),this.hasOriginal?(this.$deletebutton=this.$tools.find(".grp-delete-handler"),this.$deletebutton.bind("click",function(){var e=this.$deletebutton.prev();e.attr("checked",!e.attr("checked")),this.$row.toggleClass("grp-predelete")}.bind(this))):this.createRemoveButton(),this.formset.$templateForm.before(this.$row),this.formset.update(),this.initPrepopulatedFields(),this.formset.onAfterAdd(this.formset.$root,this.$row,this.formset.fullPrefix,this.isInitial),this.$row.find(".grp-group").each(function(t,r){e(r).formset(this.formset.onAfterAdd,this.formset.postInit,this)}.bind(this))}function r(r,i,n,a){this.$root=r,this.parentInlineForm=a,this.inlineType=this.$root.data("inline-type"),this.prefix=this.$root.data("prefix"),this.fullPrefix=this.prefix,"undefined"==typeof this.parentInlineForm||this.parentInlineForm.isInitial||(this.fullPrefix+="-"+this.parentInlineForm.index),"undefined"==typeof i&&(i=function(){}),this.onAfterAdd=i,"undefined"==typeof n&&(n=function(){}),this.postInit=n,this.addCssClass="grp-add-handler",this.removeCssClass="grp-remove-handler",this.emptyCssClass="grp-empty-form",this.formCssClass="grp-dynamic-form",this.addText=this.$root.data("add-text"),this.removeText=this.$root.data("remove-text"),this.$totalForms=this.$root.find('[name="'+this.prefix+'-TOTAL_FORMS"]').attr("autocomplete","off"),this.$initialForms=this.$root.find('[name="'+this.prefix+'-INITIAL_FORMS"]').attr("autocomplete","off"),this.$maxForms=this.$root.find('[name="'+this.prefix+'-MAX_NUM_FORMS"]').attr("autocomplete","off"),this.$totalForms.attr("name",this.fullPrefix+"-TOTAL_FORMS"),this.$initialForms.attr("name",this.fullPrefix+"-INITIAL_FORMS"),this.$maxForms.attr("name",this.fullPrefix+"-MAX_NUM_FORMS"),this.$templateForm=this.getFormsAndTemplate().filter("."+this.emptyCssClass),this.$addButton=this.$root.find("> .grp-transparent, > .grp-tools").find("."+this.addCssClass),this.$addButtonContainer=this.$addButton.parents(".grp-transparent"),this.forms=[],this.getForms().each(function(r,i){new t(this,e(i))}.bind(this)),this.$addButton.click(this.addHandler.bind(this)),this.postInit(r,this.fullPrefix)}t.prototype.createRemoveButton=function(){this.$removeButton=this.$tools.find("."+this.formset.removeCssClass),this.$removeButton.click(this.removeHandler.bind(this))},t.prototype.removeHandler=function(e){e.preventDefault(),this.$row.remove(),this.formset.forms.splice(this.index,1),this.formset.update()},t.prototype.initPrepopulatedFields=function(){var t=this.$row;t.find(".prepopulated_field").each(function(){var r=e(this).find("input, select, textarea"),i=r.data("dependency_list")||[],n=[];e.each(i,function(e,r){n.push("#"+t.find(".field-"+r).find("input, select, textarea").attr("id"))}),n.length&&r.prepopulate(n,r.attr("maxlength"))})},t.prototype.fillAttrPlaceholders=function(){var t=this.$row.find("*").addBack(),r=new RegExp("((?:"+this.formset.fullPrefix+"|"+this.formset.prefix+")-(?:\\d+|__prefix__))"),i=this.prefix;e.each(["for","id","name"],function(n,a){t.each(function(){var t=e(this),n=t.attr(a);n&&t.attr(a,n.replace(r,i))})})},t.prototype.updateIndex=function(e){this.index=e,this.prefix=this.formset.fullPrefix+"-"+this.index},t.prototype.update=function(e){this.updateIndex(e),this.fillAttrPlaceholders()},r.prototype.getFormsAndTemplate=function(){return this.$root.find("tabular"==this.inlineType?"> .grp-table > .grp-tbody":"> .grp-items > .grp-module")},r.prototype.getForms=function(){return this.getFormsAndTemplate().not("."+this.emptyCssClass)},r.prototype.canAdd=function(){return""===this.$maxForms.val()||this.$maxForms.val()-this.$totalForms.val()>0},r.prototype.addHandler=function(e){e.preventDefault(),this.canAdd()&&new t(this)},r.prototype.update=function(){this.forms.forEach(function(e,t){e.update(t)}),this.$totalForms.val(this.forms.length),this.$addButtonContainer.toggle(this.canAdd())},e.fn.formset=function(e,t,i){return new r(this,e,t,i),this}}(grp.jQuery);