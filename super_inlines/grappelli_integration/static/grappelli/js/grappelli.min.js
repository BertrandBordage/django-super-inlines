var grp={jQuery:jQuery.noConflict(!0)},django={jQuery:grp.jQuery},jQuery=grp.jQuery,inputTypes="[type='search'],[type='email'],[type='url'],[type='tel'],[type='number'],[type='range'],[type='date'],[type='month'],[type='week'],[type='time'],[type='datetime'],[type='datetime-local'],[type='color']";!function(e){grappelli.getFormat=function(e){if("date"==e)return DATE_FORMAT.toLowerCase().replace(/%\w/g,function(e){return(e=e.replace(/%/,""))+e})},grappelli.cleanInputTypes=function(){e("form").each(function(){e(this).find(":input").filter(inputTypes).each(function(){e(this).attr("type","text")})})},grappelli.initDateAndTimePicker=function(){e("p.datetime").each(function(){var t=e(this).html();t=(t=t.replace(/\w*: /,"")).replace(/<br>[^<]*: /g,"<br>"),e(this).html(t)});var t={constrainInput:!1,showOn:"button",buttonImageOnly:!1,buttonText:"",dateFormat:grappelli.getFormat("date"),showButtonPanel:!0,showAnim:"",beforeShow:function(e,t,r){grappelli.datepicker_instance=this}},r=e("input[class*='vDateField']:not([id*='__prefix__'])");r.datepicker(t),"undefined"!=typeof IS_POPUP&&IS_POPUP&&r.datepicker("disable"),e(document).on("click",".ui-datepicker-current",function(){e.datepicker._selectDate(grappelli.datepicker_instance),grappelli.datepicker_instance=null}),e("input[class*='vTimeField']:not([id*='__prefix__'])").grp_timepicker()},grappelli.initFilter=function(t){if(e("a.grp-pulldown-handler").on("click",function(){var t=e(this).closest(".grp-pulldown-container");e(t).toggleClass("grp-pulldown-state-open").children(".grp-pulldown-content").toggle()}),e("a.grp-pulldown-handler").on("mouseout",function(){e(this).blur()}),t||e(".grp-filter-choice").change(function(){location.href=e(this).val()}),"confirm"===t){var r=window.location.search.replace("?","").split("&"),n=[];void 0!==r[0]&&""!==r[0]&&r.map(e=>{var t=e.split("=")[0];-1!=t.search("__")&&(t=e.split("__")[0]),-1===n.findIndex(e=>e.fieldName===t)?n.push({fieldName:t,values:[e]}):n.find(e=>e.fieldName===t).values.push(e)}),e(".grp-filter-choice").change(function(){var t=e(this).data("field-name"),r="?"!==e(this).val()&&e(this).val().replace("?",""),i=r&&r.split("&"),a=i&&i.filter(e=>e.includes(t)),o=n.findIndex(e=>e.fieldName===t);o<0?a.length>0&&n.push({fieldName:t,values:a}):a.length>0?n.find(e=>e.fieldName===t).values=a:n.splice(o,1);var l=n.flatMap(e=>e.values).join("&");e(this).closest(".grp-filter").find("#grp-filter-apply").attr("href","?"+l)})}},grappelli.initSearchbar=function(){e("input.grp-search-field").trigger("focus")},grappelli.updateSelectFilter=function(e){"undefined"!=typeof SelectFilter&&(e.find(".selectfilter").each(function(e,t){var r=t.name.split("-");SelectFilter.init(t.id,r[r.length-1],!1,"{% admin_media_prefix %}")}),e.find(".selectfilterstacked").each(function(e,t){var r=t.name.split("-");SelectFilter.init(t.id,r[r.length-1],!0,"{% admin_media_prefix %}")}))},grappelli.reinitDateTimeFields=function(e){e.find(".vDateField").datepicker({constrainInput:!1,showOn:"button",buttonImageOnly:!1,buttonText:"",dateFormat:grappelli.getFormat("date")}),e.find(".vTimeField").grp_timepicker()},grappelli.get_app_label=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("?")[0].split("/");return r[r.length-3]}return!1},grappelli.get_model_name=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("?")[0].split("/");return r[r.length-2]}return!1},grappelli.get_query_string=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("/");return(pairs=r[r.length-1].replace("?","").split("&")).join(":")}return!1},grappelli.get_to_field=function(e){var t=e.next("a");if(t.length>0&&-1!==t.attr("href").indexOf("_to_field")){for(var r=t.attr("href").split("/"),n=r[r.length-1].replace("?","").split("&"),i=0;i<n.length;i++)if("_to_field"==(v=n[i].split("="))[0])return v[1]}return!1}}(grp.jQuery),function(e){e.fn.grp_collapsible=function(r){var n=e.extend({toggle_handler_slctr:".grp-collapse-handler:first",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_toggle:function(){}},r);return this.each(function(){t(e(this),n)})};var t=function(e,t){t.on_init(e,t),r(e,t)},r=function(e,t){n(e,t)},n=function(e,t){e.children(t.toggle_handler_slctr).on("click",function(){e.toggleClass(t.closed_css).toggleClass(t.open_css),t.on_toggle(e,t)})}}(grp.jQuery),function(e){e.fn.grp_collapsible_group=function(r){return r=e.extend({open_handler_slctr:".grp-open-handler",close_handler_slctr:".grp-close-handler",collapsible_container_slctr:".grp-collapse",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_open:function(){},on_close:function(){}},r),this.each(function(){t(e(this),r)})};var t=function(e,t){t.on_init(e,t),r(e,t)},r=function(e,t){n(e,t),i(e,t)},n=function(t,r){t.find(r.open_handler_slctr).each(function(){e(this).on("click",function(){r.on_open(t,r),t.find(r.collapsible_container_slctr).removeClass(r.closed_css).addClass(r.open_css),t.removeClass(r.closed_css).addClass(r.open_css)})})},i=function(t,r){t.find(r.close_handler_slctr).each(function(){e(this).on("click",function(){r.on_close(t,r),t.find(r.collapsible_container_slctr).removeClass(r.open_css).addClass(r.closed_css)})})}}(grp.jQuery),function(e){e.widget("ui.grp_timepicker",{options:{template:'<div id="ui-timepicker" class="module" style="position: absolute; display: none;"></div>',timepicker_selector:"#ui-timepicker",offset:{top:0},default_time_list:["now","00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],time_list:[]},_create:function(){var t=this;e(document).on("mousedown",function(r){if(t.timepicker.is(":visible")){var n=e(r.target);n[0].id==t.timepicker[0].id||0!==n.parents(t.options.timepicker_selector).length||n.hasClass("hasTimepicker")||n.hasClass("ui-timepicker-trigger")||t.timepicker.hide()}}),e(document).on("keyup",function(e){27==e.keyCode&&t.timepicker.hide()}),0===e(this.options.timepicker_selector).length&&e(this.options.template).appendTo("body"),this.timepicker=e(this.options.timepicker_selector),this.timepicker.hide(),this.element.addClass("hasTimepicker"),this.button=e('<button type="button" class="ui-timepicker-trigger"></button>'),this.element.after(this.button),this.element.prop("disabled")?this.button.prop("disabled",!0):this.button.on("click",function(){t._toggleTimepicker()})},_toggleTimepicker:function(){this.timepicker.is(":visible")?this.timepicker.hide():(this.element.trigger("focus"),this._generateTimepickerContents(),this._showTimepicker())},_generateTimepickerContents:function(){var t=this,r="<ul>";0===this.options.time_list.length&&(this.options.time_list=this.options.default_time_list);for(var n=0;n<this.options.time_list.length;n++)if("now"==this.options.time_list[n]){var i=new Date,a=i.getHours(),o=i.getMinutes();r+='<li class="ui-state-active row">'+(a=a<10?"0"+a:a)+":"+(o=o<10?"0"+o:o)+"</li>"}else r+='<li class="ui-state-default row">'+this.options.time_list[n]+"</li>";r+="</ul>",this.timepicker.html(r),this.timepicker.find("li").on("click",function(){e(this).parent().children("li").removeClass("ui-state-active"),e(this).addClass("ui-state-active"),t.element.val(e(this).html()),t.timepicker.hide()})},_showTimepicker:function(){var e=document.documentElement.clientHeight,t=document.documentElement.scrollTop||document.body.scrollTop,r=this.element.outerHeight(),n=this.timepicker.outerHeight()+r,i=this.element.offset().top,a=this.element.offset().left;i-t+n+60<e?this.timepicker.css("left",a+"px").css("top",i+r+"px"):this.timepicker.css("left",a+"px").css("top",i-n+r+"px"),this.timepicker.show()},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments)}})}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_fk.defaults,t),this.each(function(){var n=e(this),i=n.parent();i.find("a.related-lookup").next().is("strong")&&(i.find("a.related-lookup").get(0).nextSibling.nodeValue="",i.find("a.related-lookup").next("strong").remove()),i.find("a.related-lookup").after(t.placeholder),n.addClass("grp-has-related-lookup"),r(n,t),n.on("change focus keyup",function(){r(n,t)})})}};e.fn.grp_related_fk=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_fk"),!1):t.init.apply(this,arguments)};var r=function(t,r){var n=t.parent().find(".grp-placeholder-related-fk");e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t),to_field:grappelli.get_to_field(t)},function(t){""===t[0].label?n.hide():n.show(),t[0].safe?n.html(e('<span class="grp-placeholder-label"></span>').html(t[0].label+"‎")):n.html(e('<span class="grp-placeholder-label"></span>').text(t[0].label+"‎"))})};e.fn.grp_related_fk.defaults={placeholder:'<div class="grp-placeholder-related-fk"></div>',repr_max_length:30,lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_m2m.defaults,t),this.each(function(){var n=e(this);n.parent().find("a.related-lookup").after(t.placeholder),n.next().addClass("grp-m2m"),n.addClass("grp-has-related-lookup"),r(n,t),n.on("change focus keyup",function(){r(n,t)})})}};e.fn.grp_related_m2m=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_m2m"),!1):t.init.apply(this,arguments)};var r=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(r){""===(values=e.map(r,function(t,n){return r.length!==n+1||t.safe?r.length===n+1&&t.safe?e('<span class="grp-placeholder-label"></span>').html(t.label+"‎"):t.safe?e('<span class="grp-placeholder-label"></span>').html(t.label+"‎").append(e('<span class="grp-separator"></span>')):e('<span class="grp-placeholder-label"></span>').text(t.label+"‎").append(e('<span class="grp-separator"></span>')):e('<span class="grp-placeholder-label"></span>').text(t.label+"‎")}))?t.parent().find(".grp-placeholder-related-m2m").hide():t.parent().find(".grp-placeholder-related-m2m").show(),t.parent().find(".grp-placeholder-related-m2m").html(values)})};e.fn.grp_related_m2m.defaults={placeholder:'<div class="grp-placeholder-related-m2m"></div>',repr_max_length:30,lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_generic.defaults,t),this.each(function(){var a=e(this),o=e(t.content_type).val()||e(t.content_type).find(":checked").val();o&&a.after(t.placeholder).after(r(a.attr("id"),o)),a.addClass("grp-has-related-lookup"),o&&i(a,t),a.on("change focus keyup",function(){i(a,t)}),e(t.content_type).on("change",function(){n(e(this),t)})})}};e.fn.grp_related_generic=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_generic"),!1):t.init.apply(this,arguments)};var r=function(t,r){var n=e('<a class="related-lookup"></a>');return n.attr("id","lookup_"+t),n.attr("href",window.ADMIN_URL+MODEL_URL_ARRAY[r].app+"/"+MODEL_URL_ARRAY[r].model+"/?"),n.attr("onClick","return showRelatedObjectLookupPopup(this);"),n},n=function(t,n){var i=e(n.object_id);i.val(""),i.parent().find("a.related-lookup").remove(),i.parent().find(".grp-placeholder-related-generic").remove();var a=e(t).val()||e(t).find(":checked").val();a&&i.after(n.placeholder).after(r(i.attr("id"),a))},i=function(t,r){var n=t.next().next();e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(t){""===t[0].label?n.hide():n.show(),t[0].safe?n.html(e('<span class="grp-placeholder-label"></span>').html(t[0].label+"‎")):n.html(e('<span class="grp-placeholder-label"></span>').text(t[0].label+"‎"))})};e.fn.grp_related_generic.defaults={placeholder:'<div class="grp-placeholder-related-generic" style="display:none"></div>',repr_max_length:30,lookup_url:"",content_type:"",object_id:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_fk.defaults,t),this.each(function(){var o=e(this);o.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field"),o.next().next()&&"errorlist"!=o.next().next().attr("class")&&"grp-help"!=o.next().next().attr("class")&&o.next().next().remove(),o.next().after(r).after(n(o.attr("id"))),o.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>"),o.parent().prepend("<input id='"+o.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />"),t=e.extend({wrapper_autocomplete:o.parent(),input_field:o.prev(),remove_link:o.next().next().hide(),loader:o.next().next().next().hide()},e.fn.grp_autocomplete_fk.defaults,t),a(o,t),i(o,t),o.on("change focus keyup",function(){a(o,t)}),e("label[for='"+o.attr("id")+"']").each(function(){e(this).attr("for",o.attr("id")+"-autocomplete")})})}};e.fn.grp_autocomplete_fk=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_fk"),!1):t.init.apply(this,arguments)};var r=function(){return e('<div class="grp-loader">loader</div>')},n=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},i=function(t,r){r.wrapper_autocomplete.find("input:first").on("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).on("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,source:function(n,i){e.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(n.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t)+"&to_field="+grappelli.get_to_field(t),beforeSend:function(e){r.loader.show()},success:function(t){i(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){r.loader.hide()}})},focus:function(){return!1},select:function(n,i){return r.input_field.val(i.item.label),t.val(i.item.value),t.trigger("change"),t.val()?e(r.remove_link).show():e(r.remove_link).hide(),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append(e("<a></a>").text(r.label)).appendTo(t):e("<li class='ui-state-disabled'></li>").data("item.autocomplete",r).append(e("<span class='error'></span>").text(r.label)).appendTo(t)}},a=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t),to_field:grappelli.get_to_field(t)},function(n){e.each(n,function(i){r.input_field.val(n[i].label),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})})};e.fn.grp_autocomplete_fk.defaults={autocomplete_lookup_url:"",lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_m2m.defaults,t),this.each(function(){var r=e(this);r.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field"),r.next().after(i).after(a(r.attr("id"))),r.parent().wrapInner("<div class='grp-autocomplete-wrapper-m2m'></div>"),r.parent().prepend("<ul class='grp-repr'><li class='grp-search'><input id='"+r.attr("id")+"-autocomplete' type='text' class='vTextField' value='' /></li></ul>"),t=e.extend({wrapper_autocomplete:r.parent(),wrapper_repr:r.parent().find("ul.grp-repr"),wrapper_search:r.parent().find("li.grp-search"),remove_link:r.next().next().hide(),loader:r.next().next().next().hide()},e.fn.grp_autocomplete_m2m.defaults,t),r.parent().find("ul.errorlist")&&r.parent().find("ul.errorlist").detach().appendTo(r.parent().parent()),r.parent().find("p.grp-help")&&r.parent().find("p.grp-help").detach().appendTo(r.parent().parent()),s(r,t),l(r,t),r.on("change focus keyup",function(){s(r,t)}),e("label[for='"+r.attr("id")+"']").each(function(){e(this).attr("for",r.attr("id")+"-autocomplete")}),t.wrapper_autocomplete.on("click",function(r){e(r.target).hasClass("related-lookup")||e(r.target).hasClass("grp-related-remove")||t.wrapper_search.find("input:first").trigger("focus")})})}};e.fn.grp_autocomplete_m2m=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_m2m"),!1):t.init.apply(this,arguments)};var r=function(e,t,r){var n=[];return e.val()&&(n=e.val().split(",")),n.push(t),e.val(n.join(",")),e.trigger("change"),n.join(",")},n=function(e,t,r){var n=[];return e.val()&&(n=e.val().split(",")),n.splice(t,1),e.val(n.join(",")),e.trigger("change"),n.join(",")},i=function(){return e('<div class="grp-loader">loader</div>')},a=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},o=function(t,r,i){var a=e('<li class="grp-repr"></li>'),o=e('<a class="grp-m2m-remove" href="javascript://"></a>').text(r);a.append(o),a.insertBefore(i.wrapper_search),o.on("click",function(r){var a=e(this).parent().parent().children("li").index(e(this).parent());n(t,a,i),e(this).parent().remove(),t.val()?e(i.remove_link).show():e(i.remove_link).hide(),r.stopPropagation()}),o.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")})},l=function(t,n){n.wrapper_search.find("input:first").on("keydown",function(t){t.keyCode===e.ui.keyCode.TAB&&e(this).data("uiAutocomplete").menu.active&&t.preventDefault()}).on("focus",function(){n.wrapper_autocomplete.addClass("grp-state-focus")}).on("blur",function(){n.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,position:{my:"left top",at:"left bottom",of:n.wrapper_autocomplete},open:function(t,r){e(".ui-menu").width(n.wrapper_autocomplete.outerWidth()-6)},source:function(r,i){e.ajax({url:n.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(r.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(e){n.loader.show()},success:function(t){i(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){n.loader.hide()}})},focus:function(){return!1},select:function(i,a){return o(t,a.item.label,n),r(t,a.item.value,n),t.val()?e(n.remove_link).show():e(n.remove_link).hide(),e(this).val("").trigger("focus"),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append(e("<a></a>").text(r.label)).appendTo(t):e("<li class='ui-state-disabled'></li>").data("item.autocomplete",r).append(e("<span class='error'></span>").text(r.label)).appendTo(t)}},s=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(n){r.wrapper_repr.find("li.grp-repr").remove(),r.wrapper_search.find("input").val(""),e.each(n,function(e){n[e].value&&o(t,n[e].label,r)}),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_generic.defaults,t),this.each(function(){var s=e(this);s.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field");var p=e(t.content_type).val()||e(t.content_type).find(":checked").val();p&&s.after(r).after(n(s.attr("id"))).after(i(s.attr("id"),p)),s.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>"),s.parent().prepend("<input id='"+s.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />"),t=e.extend({wrapper_autocomplete:e(this).parent(),input_field:e(this).prev(),remove_link:s.nextAll("a.grp-related-remove").hide(),loader:s.nextAll("div.grp-loader").hide()},e.fn.grp_autocomplete_generic.defaults,t),p&&l(s,t),o(s,t),s.on("change focus keyup",function(){l(s,t)}),e(t.content_type).on("change",function(){a(e(this),t)}),e("label[for='"+s.attr("id")+"']").each(function(){e(this).attr("for",s.attr("id")+"-autocomplete")})})}};e.fn.grp_autocomplete_generic=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_generic"),!1):t.init.apply(this,arguments)};var r=function(){return e('<div class="grp-loader">loader</div>')},n=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},i=function(t,r){var n=e('<a class="related-lookup"></a>');return n.attr("id","lookup_"+t),n.attr("href",window.ADMIN_URL+MODEL_URL_ARRAY[r].app+"/"+MODEL_URL_ARRAY[r].model+"/?"),n.attr("onClick","return showRelatedObjectLookupPopup(this);"),n},a=function(t,a){var o=e(a.object_id);o.val(""),o.prev().val(""),o.nextAll("a.related-lookup").remove(),o.nextAll("a.grp-related-remove").remove(),o.nextAll("div.grp-loader").remove();var l=e(t).val()||e(t).find(":checked").val();l&&(o.after(r).after(n(o.attr("id"))).after(i(o.attr("id"),l)),a.remove_link=o.nextAll("a.grp-related-remove").hide(),a.loader=o.nextAll("div.grp-loader").hide())},o=function(t,r){r.wrapper_autocomplete.find("input:first").on("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).on("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,source:function(n,i){e.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(n.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(t){if(!(e(r.content_type).val()||e(r.content_type).find(":checked").val()))return!1;r.loader.show()},success:function(t){i(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){r.loader.hide()}})},focus:function(){return!1},select:function(n,i){return r.input_field.val(i.item.label),t.val(i.item.value),t.trigger("change"),t.val()?e(r.remove_link).show():e(r.remove_link).hide(),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append(e("<a></a>").text(r.label)).appendTo(t):e("<li class='ui-state-disabled'></li>").data("item.autocomplete",r).append(e("<span class='error'></span>").text(r.label)).appendTo(t)}},l=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(n){e.each(n,function(i){r.input_field.val(n[i].label),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})})};e.fn.grp_autocomplete_generic.defaults={autocomplete_lookup_url:"",lookup_url:"",content_type:"",object_id:""}}(grp.jQuery),function(e){function t(t,r){if(this.formset=t,this.updateIndex(this.formset.forms.length),this.formset.forms.push(this),this.isInitial=void 0!==r,this.isInitial){this.$row=r;var n=this.$row.find('[name="'+this.prefix+'-id"]');this.hasOriginal=""!==n.val()}else this.$row=this.formset.$templateForm.clone(!0).removeClass(this.formset.emptyCssClass).addClass(this.formset.formCssClass),this.hasOriginal=!1;"tabular"==this.formset.inlineType?this.$tools=this.$row.find("> .grp-tr > .grp-tools-container > .grp-tools"):this.$tools=this.$row.find("> .grp-tools"),this.hasOriginal?(this.$deletebutton=this.$tools.find(".grp-delete-handler"),this.$deletebutton.bind("click",(function(){var e=this.$deletebutton.prev();e.attr("checked",!e.attr("checked")),this.$row.toggleClass("grp-predelete")}).bind(this))):this.createRemoveButton(),this.formset.$templateForm.before(this.$row),this.formset.update(),this.initPrepopulatedFields(),this.formset.onAfterAdd(this.formset.$root,this.$row,this.formset.fullPrefix,this.isInitial),this.$row.find(".grp-group").each((function(t,r){e(r).formset(this.formset.onAfterAdd,this.formset.postInit,this)}).bind(this))}function r(r,n,i,a){this.$root=r,this.parentInlineForm=a,this.inlineType=this.$root.data("inline-type"),this.prefix=this.$root.data("prefix"),this.fullPrefix=this.prefix,void 0===this.parentInlineForm||this.parentInlineForm.isInitial||(this.fullPrefix+="-"+this.parentInlineForm.index),void 0===n&&(n=function(e,t){}),this.onAfterAdd=n,void 0===i&&(i=function(e,t){}),this.postInit=i,this.addCssClass="grp-add-handler",this.removeCssClass="grp-remove-handler",this.emptyCssClass="grp-empty-form",this.formCssClass="grp-dynamic-form",this.addText=this.$root.data("add-text"),this.removeText=this.$root.data("remove-text"),this.$totalForms=this.$root.find('[name="'+this.prefix+'-TOTAL_FORMS"]').attr("autocomplete","off"),this.$initialForms=this.$root.find('[name="'+this.prefix+'-INITIAL_FORMS"]').attr("autocomplete","off"),this.$maxForms=this.$root.find('[name="'+this.prefix+'-MAX_NUM_FORMS"]').attr("autocomplete","off"),this.$totalForms.attr("name",this.fullPrefix+"-TOTAL_FORMS"),this.$initialForms.attr("name",this.fullPrefix+"-INITIAL_FORMS"),this.$maxForms.attr("name",this.fullPrefix+"-MAX_NUM_FORMS"),this.$templateForm=this.getFormsAndTemplate().filter("."+this.emptyCssClass),this.$addButton=this.$root.find("> .grp-transparent, > .grp-tools").find("."+this.addCssClass),this.$addButtonContainer=this.$addButton.parents(".grp-transparent"),this.forms=[],this.getForms().each((function(r,n){new t(this,e(n))}).bind(this)),this.$addButton.click(this.addHandler.bind(this)),this.postInit(r,this.fullPrefix)}t.prototype.createRemoveButton=function(){this.$removeButton=this.$tools.find("."+this.formset.removeCssClass),this.$removeButton.click(this.removeHandler.bind(this))},t.prototype.removeHandler=function(e){e.preventDefault(),this.$row.remove(),this.formset.forms.splice(this.index,1),this.formset.update()},t.prototype.initPrepopulatedFields=function(){var t=this.$row;t.find(".prepopulated_field").each(function(){var r=e(this).find("input, select, textarea"),n=r.data("dependency_list")||[],i=[];e.each(n,function(e,r){i.push("#"+t.find(".field-"+r).find("input, select, textarea").attr("id"))}),i.length&&r.prepopulate(i,r.attr("maxlength"))})},t.prototype.fillAttrPlaceholders=function(){var t=this.$row.find("*").addBack(),r=RegExp("((?:"+this.formset.fullPrefix+"|"+this.formset.prefix+")-(?:\\d+|__prefix__))"),n=this.prefix;e.each(["for","id","name"],function(i,a){t.each(function(){var t=e(this),i=t.attr(a);i&&t.attr(a,i.replace(r,n))})})},t.prototype.updateIndex=function(e){this.index=e,this.prefix=this.formset.fullPrefix+"-"+this.index},t.prototype.update=function(e){this.updateIndex(e),this.fillAttrPlaceholders()},r.prototype.getFormsAndTemplate=function(){return"tabular"==this.inlineType?this.$root.find("> .grp-table > .grp-tbody"):this.$root.find("> .grp-items > .grp-module")},r.prototype.getForms=function(){return this.getFormsAndTemplate().not("."+this.emptyCssClass)},r.prototype.canAdd=function(){return""===this.$maxForms.val()||this.$maxForms.val()-this.$totalForms.val()>0},r.prototype.addHandler=function(e){e.preventDefault(),this.canAdd()&&new t(this)},r.prototype.update=function(){this.forms.forEach(function(e,t){e.update(t)}),this.$totalForms.val(this.forms.length),this.$addButtonContainer.toggle(this.canAdd())},e.fn.formset=function(e,t,n){return new r(this,e,t,n),this}}(grp.jQuery);
