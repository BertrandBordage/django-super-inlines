!function(t){function e(e,i){if(this.formset=e,this.updateIndex(this.formset.forms.length),this.formset.forms.push(this),this.isInitial="undefined"!=typeof i,this.isInitial){this.$row=i;var o=this.$row.find('[name="'+this.prefix+'-id"]');this.hasOriginal=""!==o.val()}else this.$row=this.formset.$templateForm.clone(!0).removeClass(this.formset.emptyCssClass).addClass(this.formset.formCssClass),this.hasOriginal=!1;this.hasOriginal||this.createRemoveButton(),this.formset.$templateForm.before(this.$row),this.formset.update(),this.initPrepopulatedFields(),s(),n(),this.$row.find(".inline-group").each(function(e,i){t(i).formset(this)}.bind(this))}function i(i,s){if(this.$root=i,this.parentInlineForm=s,this.inlineType=this.$root.data("inline-type"),this.prefix=this.$root.data("prefix"),this.fullPrefix=this.prefix,"undefined"==typeof this.parentInlineForm||this.parentInlineForm.isInitial||(this.fullPrefix+="-"+this.parentInlineForm.index),this.addCssClass="add-row",this.removeCssClass="inline-deletelink",this.emptyCssClass="empty-form",this.formCssClass="dynamic-"+this.prefix,this.addText=this.$root.data("add-text"),this.removeText=this.$root.data("remove-text"),this.$totalForms=this.$root.find('[name="'+this.prefix+'-TOTAL_FORMS"]').attr("autocomplete","off"),this.$initialForms=this.$root.find('[name="'+this.prefix+'-INITIAL_FORMS"]').attr("autocomplete","off"),this.$maxForms=this.$root.find('[name="'+this.prefix+'-MAX_NUM_FORMS"]').attr("autocomplete","off"),this.$totalForms.attr("name",this.fullPrefix+"-TOTAL_FORMS"),this.$initialForms.attr("name",this.fullPrefix+"-INITIAL_FORMS"),this.$maxForms.attr("name",this.fullPrefix+"-MAX_NUM_FORMS"),this.$templateForm=this.getFormsAndTemplate().filter("."+this.emptyCssClass),this.$addButton=t('<a href="#">'+this.addText+"</a>"),"tabular"==this.inlineType){var n=this.$templateForm.children().length;this.$addButtonContainer=t('<tr class="'+this.addCssClass+'"><td colspan="'+n+'"></td></tr>'),this.$addButtonContainer.find("td").append(this.$addButton)}else this.$addButtonContainer=t('<div class="'+this.addCssClass+'"></div>'),this.$addButtonContainer.append(this.$addButton);this.$templateForm.after(this.$addButtonContainer),this.forms=[],this.getForms().each(function(i,s){new e(this,t(s))}.bind(this)),this.$addButton.click(this.addHandler.bind(this))}function s(){"undefined"!=typeof DateTimeShortcuts&&(t(".datetimeshortcuts").remove(),DateTimeShortcuts.init())}function n(){function e(t){return function(){var e=this.name.split("-");SelectFilter.init(this.id,e[e.length-1],t)}}"undefined"!=typeof SelectFilter&&(t(".selectfilter").each(e(!1)),t(".selectfilterstacked").each(e(!0)))}e.prototype.createRemoveButton=function(){this.$removeButton=t('<a class="'+this.formset.removeCssClass+'" href="#">'+this.formset.removeText+"</a>"),"tabular"==this.formset.inlineType?(this.$removeButtonContainer=t("<div></div>"),this.$row.children(":last").append(this.$removeButtonContainer)):(this.$removeButtonContainer=t("<span></span>"),this.$row.children(":first").append(this.$removeButtonContainer)),this.$removeButtonContainer.append(this.$removeButton),this.$removeButton.click(this.removeHandler.bind(this))},e.prototype.removeHandler=function(t){t.preventDefault(),this.$row.remove(),this.formset.forms.splice(this.index,1),this.formset.update()},e.prototype.initPrepopulatedFields=function(){var e=this.$row;e.find(".prepopulated_field").each(function(){var i=t(this).find("input, select, textarea"),s=i.data("dependency_list")||[],n=[];t.each(s,function(t,i){n.push("#"+e.find(".field-"+i).find("input, select, textarea").attr("id"))}),n.length&&i.prepopulate(n,i.attr("maxlength"))})},e.prototype.fillAttrPlaceholders=function(){var e=this.$row.find("*").addBack(),i=new RegExp("((?:"+this.formset.fullPrefix+"|"+this.formset.prefix+")-(?:\\d+|__prefix__))"),s=this.prefix;t.each(["for","id","name"],function(n,o){e.each(function(){var e=t(this),n=e.attr(o);n&&e.attr(o,n.replace(i,s))})})},e.prototype.updateIndex=function(t){this.index=t,this.prefix=this.formset.fullPrefix+"-"+this.index},e.prototype.updateClass=function(){this.index%2==0?this.$row.addClass("row1").removeClass("row2"):this.$row.addClass("row2").removeClass("row1")},e.prototype.updateLabel=function(){var t=this.$row.find("> h3 > .inline_label");t.html(t.html().replace(/(#\d+)/g,"#"+(this.index+1)))},e.prototype.update=function(t){this.updateIndex(t),this.fillAttrPlaceholders(),"tabular"==this.formset.inlineType?this.updateClass():this.updateLabel()},i.prototype.getFormsAndTemplate=function(){var t=this.$root.find("> .inline-related");return"tabular"==this.inlineType?t.find("> fieldset > table > tbody > .form-row"):t},i.prototype.getForms=function(){return this.getFormsAndTemplate().not("."+this.emptyCssClass)},i.prototype.canAdd=function(){return""===this.$maxForms.val()||this.$maxForms.val()-this.$totalForms.val()>0},i.prototype.addHandler=function(t){t.preventDefault(),this.canAdd()&&new e(this)},i.prototype.update=function(){this.forms.forEach(function(t,e){t.update(e)}),this.$totalForms.val(this.forms.length),this.$addButtonContainer.toggle(this.canAdd())},t.fn.formset=function(t){return new i(this,t),this}}(django.jQuery);